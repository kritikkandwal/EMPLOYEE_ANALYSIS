{% extends "base.html" %}
{% block title %}Attendance Calendar - AI Productivity Intelligence{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title"><i class="fas fa-calendar-alt"></i> Productivity Attendance (2025)</h1>
    <p class="page-subtitle">Track your daily productivity pattern in a sleek LeetCode-style horizontal calendar.</p>
</div><br>

<div class="attendance-grid">
    <!-- Calendar Card -->
    <div class="glass-card calendar-card">
        <div class="calendar-header">
            <h2>Productivity Calendar</h2>
            <p>Each box represents one day — brighter colors mean higher productivity.</p>
        </div>

        <div class="calendar-container">
            <div class="calendar-row" id="calendarRow">
                <!-- JS will populate months horizontally -->
            </div>
        </div>

        <div class="calendar-legend">
            <div class="legend-item"><div class="color-box high-productivity"></div><span>High (≥80%)</span></div>
            <div class="legend-item"><div class="color-box medium-productivity"></div><span>Medium (40–79%)</span></div>
            <div class="legend-item"><div class="color-box low-productivity"></div><span>Low (&lt;40%)</span></div>
            <div class="legend-item"><div class="color-box absent"></div><span>Absent</span></div>
        </div>
    </div>
<br>
    <!-- Stats -->
    <div class="glass-card stats-card">
        <h2>Attendance Statistics</h2>
        <div class="stats-grid">
            <div class="stat-item"><div class="stat-value">11</div><div class="stat-label">Current Streak</div></div>
            <div class="stat-item"><div class="stat-value">93%</div><div class="stat-label">Attendance Rate</div></div>
            <div class="stat-item"><div class="stat-value">80%</div><div class="stat-label">Avg Productivity</div></div>
            <div class="stat-item"><div class="stat-value">365</div><div class="stat-label">Days Tracked</div></div>
        </div>
    </div>
<br>
    <!-- AI Predictions -->
    <div class="glass-card predictions-card">
        <h2>AI Predictions</h2>
        <div class="prediction-content">
            <div class="prediction-item">
                <div class="prediction-icon"><i class="fas fa-brain"></i></div>
                <div class="prediction-text">
                    <h4>Next Week Forecast</h4>
                    <p>Expected productivity: <strong>85%</strong></p>
                    <small>Based on recent consistency</small>
                </div>
            </div>
            <div class="prediction-item">
                <div class="prediction-icon"><i class="fas fa-lightbulb"></i></div>
                <div class="prediction-text">
                    <h4>Optimal Days</h4>
                    <p>Tuesday – Thursday show peak focus</p>
                    <small>Plan important work during these days</small>
                </div>
            </div>
            <div class="prediction-item">
                <div class="prediction-icon"><i class="fas fa-bed"></i></div>
                <div class="prediction-text">
                    <h4>Rest Suggestion</h4>
                    <p>Take Friday evenings off for recovery</p>
                    <small>Detected lower productivity trend</small>
                </div>
            </div>
        </div>
    </div>
<br>
    <!-- Streak Chart -->
    <div class="glass-card streak-card">
        <h2>Streak History</h2>
        <div class="streak-chart"><canvas id="streakChart"></canvas></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    generateLeetCodeStyleCalendar();
    initializeStreakChart();
});

function generateLeetCodeStyleCalendar() {
    const calendarRow = document.getElementById('calendarRow');
    const months = [
        { name: "Nov", year: 2024, month: 10 },
        { name: "Dec", year: 2024, month: 11 },
        { name: "Jan", year: 2025, month: 0 },
        { name: "Feb", year: 2025, month: 1 },
        { name: "Mar", year: 2025, month: 2 },
        { name: "Apr", year: 2025, month: 3 },
        { name: "May", year: 2025, month: 4 },
        { name: "Jun", year: 2025, month: 5 },
        { name: "Jul", year: 2025, month: 6 },
        { name: "Aug", year: 2025, month: 7 },
        { name: "Sep", year: 2025, month: 8 },
        { name: "Oct", year: 2025, month: 9 }
    ];
    const weekdays = ["S","M","T","W","T","F","S"];

    months.forEach(monthObj => {
        const monthContainer = document.createElement('div');
        monthContainer.className = 'month-container';

        const monthTitle = document.createElement('div');
        monthTitle.className = 'month-title';
        monthTitle.textContent = monthObj.name;
        monthContainer.appendChild(monthTitle);

        const weekdaysRow = document.createElement('div');
        weekdaysRow.className = 'weekdays';
        weekdays.forEach(day => {
            const d = document.createElement('div');
            d.className = 'weekday';
            d.textContent = day;
            weekdaysRow.appendChild(d);
        });
        monthContainer.appendChild(weekdaysRow);

        const daysGrid = document.createElement('div');
        daysGrid.className = 'days-grid';

        const firstDay = new Date(monthObj.year, monthObj.month, 1);
        const totalDays = new Date(monthObj.year, monthObj.month + 1, 0).getDate();
        const startOffset = firstDay.getDay();

        for (let i = 0; i < startOffset; i++) {
            const empty = document.createElement('div');
            empty.className = 'day-cell empty';
            daysGrid.appendChild(empty);
        }

        for (let day = 1; day <= totalDays; day++) {
            const dayCell = document.createElement('div');
            dayCell.className = 'day-cell';
            const productivity = Math.random() * 100;

            if (productivity >= 80) dayCell.classList.add('high-productivity');
            else if (productivity >= 40) dayCell.classList.add('medium-productivity');
            else if (productivity > 0) dayCell.classList.add('low-productivity');
            else dayCell.classList.add('absent');

            if (monthObj.year === 2025 && monthObj.month === 4 && day === 26) {
                dayCell.classList.add('high-productivity');
                dayCell.title = '3 submissions on May 26, 2025';
            } else {
                dayCell.title = `${monthObj.name} ${day}, ${monthObj.year}`;
            }

            daysGrid.appendChild(dayCell);
        }

        monthContainer.appendChild(daysGrid);
        calendarRow.appendChild(monthContainer);
    });
}

function initializeStreakChart() {
    const ctx = document.getElementById("streakChart").getContext("2d");
    const weeks = ["Week 1", "Week 2", "Week 3", "Week 4"];
    const productivity = [70, 82, 78, 85];
    const attendance = [100, 90, 95, 100];

    new Chart(ctx, {
        type: "line",
        data: {
            labels: weeks,
            datasets: [
                { label: "Productivity %", data: productivity, borderColor: "#00ffff", backgroundColor: "rgba(0,255,255,0.15)", fill: true, tension: 0.4 },
                { label: "Attendance %", data: attendance, borderColor: "#00ff88", backgroundColor: "rgba(0,255,136,0.1)", fill: true, tension: 0.4 }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { labels: { color: "#fff" } } },
            scales: {
                y: { beginAtZero: true, max: 100, ticks: { color: "#fff" }, grid: { color: "rgba(255,255,255,0.1)" } },
                x: { ticks: { color: "#fff" }, grid: { color: "rgba(255,255,255,0.1)" } }
            }
        }
    });
}
</script>

<style>
.calendar-container {
    background: rgba(255,255,255,0.03);
    border-radius: 12px;
    padding: 20px;
    overflow-x: auto;
}
.calendar-row {
    display: flex;
    gap: 25px;
    min-width: max-content;
    padding-bottom: 10px;
}
.month-container {
    min-width: 220px;
}
.month-title {
    text-align: center;
    color: var(--primary-glow);
    font-weight: 600;
    margin-bottom: 10px;
}
.weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    margin-bottom: 5px;
    text-align: center;
    font-size: 11px;
    color: var(--text-secondary);
}
.days-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 2px;
}
.day-cell {
    width: 16px;
    height: 16px;
    border-radius: 3px;
    transition: transform 0.2s ease;
    cursor: pointer;
}
.day-cell:hover { transform: scale(1.2); }
.empty { background: transparent; }
.high-productivity { background: #00ff88; }
.medium-productivity { background: #ffaa00; }
.low-productivity { background: #ff4444; }
.absent { background: #333; }

.calendar-legend {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 20px;
    flex-wrap: wrap;
}
.legend-item { display: flex; align-items: center; gap: 5px; font-size: 0.85rem; }
.color-box { width: 14px; height: 14px; border-radius: 3px; }
.stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.stat-item {
    text-align: center;
    padding: 20px;
    background: rgba(255,255,255,0.03);
    border-radius: 12px;
}
.stat-value {
    font-size: 2rem;
    font-weight: bold;
    background: linear-gradient(135deg, var(--primary-glow), var(--secondary-glow));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
.prediction-content { display: flex; flex-direction: column; gap: 15px; }
.prediction-item { display: flex; align-items: flex-start; gap: 15px; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 12px; }
.prediction-icon { font-size: 1.5rem; color: var(--primary-glow); }
.prediction-text h4 { margin-bottom: 5px; color: var(--text-primary); }
.prediction-text p, .prediction-text small { color: var(--text-secondary); }
.streak-chart { height: 220px; position: relative; }

@media (max-width: 768px) {
    .attendance-grid { grid-template-columns: 1fr; }
    .stats-grid { grid-template-columns: 1fr; }
}
</style>
{% endblock %}
